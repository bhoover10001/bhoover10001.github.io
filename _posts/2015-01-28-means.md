---
layout: page
title: Means averaging
date: 21-Jan-2015
---

This calculates the means average of each pixel in a block around the pixel.

<canvas id="greyScale" />

<div>
My cat - the Tigress.<br />

Block Size: <input type="text" value="3" id="blockSize" size="2" /> <input id="go" type="submit" value="Go" />
</div>

<canvas id="meanAveraging" />


{% highlight JavaScript %}  

function localMeansGreyScale(canvas, blockSize) {
  var map = getContext(canvas).getImageData(0,0, canvas.width, canvas.height);
  var pixels = map.data;
  var window = Math.floor(blockSize /2);
  for (var y = 0; y < canvas.height; y += 1) {
    for (var x = 0; x < canvas.width; x += 1) {
      var startY = Math.max(0, y - window);
      var startX = Math.max(0, x - window);
      var endY = Math.min(canvas.height, y + window);
      var endX = Math.min(canvas.width, x + window);
      var greyScaleAverage = 0;
      for (var y1 = startY; y1 < endY; y1 += 1) {
         for (var x1 = startX; x1 < endX; x1 +=1) {
           greyScaleAverage += pixels[(y1 * canvas.width * 4) + x1 * 4];
         }
      }
      greyScaleAverage = greyScaleAverage / ((endX - startX) * (endY - startY));
      var currentRedPixel = (y * canvas.width * 4) + x * 4;
      pixels[currentRedPixel] = pixels[currentRedPixel + 1] = pixels[currentRedPixel + 2] = greyScaleAverage;
    }
  }
  getContext(canvas).putImageData(map, 0, 0);
}
{% endhighlight %}

<script src="{{ page.base_url }}/assets/js/image.js"></script>
<script>
  var img = new Image();   // Create new img element
  var greyScaleCanvas = document.getElementById('greyScale');
  img.addEventListener("load", function() {
    setToCanvas(img, greyScaleCanvas);
    convertToGreyScale(greyScaleCanvas);
    setToCanvas(img, meanAveraging);
    convertToGreyScale(meanAveraging);
    localMeansGreyScale(meanAveraging, $('#blockSize').val());
  }, false);
  
  img.src = '{{ page.base_url }}/img/Ferocious_Tammy.png'; // Set source path
  
  $('#go').click(function() {
    setToCanvas(img, meanAveraging);
    convertToGreyScale(meanAveraging);
    localMeansGreyScale(meanAveraging, $('#blockSize').val());
  });
</script>