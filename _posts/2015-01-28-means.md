---
layout: page
title: Means averaging
date: 28-Jan-2015
---

This calculates the means average of each pixel in a block around the pixel.

<canvas id="greyScale" />

<div>
My cat - the Tigress.<br />

Block Size<br />
<input id="blockSize"
  value="3"
  data-slider-id='ex1Slider' 
  type="text" 
  data-slider-min="1" 
  data-slider-max="20" 
  data-slider-step="1"
  data-slider-value="3"/>&nbsp;
<input id="go" type="submit" value="Go" /> <span class="processing" style="display:none;" >
  Processing
</span>
<br />
</div>


<canvas id="meanAveraging" />


{% highlight JavaScript %}  
function localMeansGreyScale(canvas, blockSize) {
  var map = getContext(canvas).getImageData(0,0, canvas.width, canvas.height);
  var pixels = map.data;
  var window = Math.floor(blockSize /2);
  if (blockSize > 1) {
    for (var y = 0; y < canvas.height; y += 1) {
      for (var x = 0; x < canvas.width; x += 1) {
        var startY = Math.max(0, y - window);
        var startX = Math.max(0, x - window);
        var endY = Math.min(canvas.height -1, y + window);
        var endX = Math.min(canvas.width -1, x + window);
        var greyScalePixels = [];
        for (var y1 = startY; y1 <= endY; y1 += 1) {
           for (var x1 = startX; x1 <= endX; x1 +=1) {
             greyScalePixels.push(pixels[(y1 * canvas.width * 4) + x1 * 4]);
           }
        }
        setGreyPixels(pixels, currentPixelArrayLocation(y, x, canvas.width), mean(greyScalePixels));
      }
    }
  }
  getContext(canvas).putImageData(map, 0, 0);
}

function setGreyPixels(pixels, arrayLocation, value) {
  pixels[arrayLocation] = pixels[arrayLocation + 1] = pixels[arrayLocation + 2] = value;
}

function mean(pixelArray) {
  var total = pixelArray.reduce(function(a,b) {return a+b});
  return Math.floor(total/pixelArray.length);
}
{% endhighlight %}

<script>
  $(function() {
    var img = new Image();   // Create new img element
    var greyScaleCanvas = document.getElementById('greyScale');
    var progressBar = $('#progressBar .progress-bar');
    img.addEventListener("load", function() {
      setToCanvas(img, greyScaleCanvas);
      convertToGreyScale(greyScaleCanvas);
      generateBlurredImage($('#blockSize').val());
    }, false);
    
    function generateBlurredImage(blockSize) {
      setToCanvas(img, meanAveraging);
      convertToGreyScale(meanAveraging);
      localMeansGreyScale(meanAveraging, blockSize);
    }
    img.src = '{{ page.base_url }}/img/Ferocious_Tammy.png'; // Set source path
    
    var showProcessing = function displayProcessing() {
      console.log('showProcessing processing');
      $('.processing').hide();
      return $('.processing').html("Processing").fadeIn(20);
    }
    $('#go').click(function() {
      $.when(showProcessing()).done(
        function() {
          console.log("done");
          generateBlurredImage($('#blockSize').val());
          $('.processing').html("Completed");
        }
      )
    });
    
    $('#blockSize').slider({
      formatter: function(value) {
        return 'Current value: ' + value;
      }
    });
  });
  
</script>